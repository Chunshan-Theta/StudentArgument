<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <link rel="apple-touch-icon" sizes="76x76" href="assets/img/apple-icon.png">
    <link rel="icon" type="image/png" href="assets/img/favicon.png">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

    <title>Chatroom</title>

    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />

    <!--     Fonts and icons     -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" />
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" />

    <!-- CSS Files -->
    <link href="assets/css/bootstrap.min.css" rel="stylesheet" />
    <link href="assets/css/material-kit.css" rel="stylesheet"/>

    <!-- CSS Just for demo purpose, don't include it in your project -->
    <link href="assets/css/demo.css" rel="stylesheet" />
    
    <!--cheditor-->
    <script src="/assets/js/ckeditor/ckeditor.js"></script>
    
    <style>
        form { background: #000; padding: 3px; bottom: 0; width: 100%; }
        form input { border: 0; padding: 10px; width: 90%; margin-right: .5%; }
        form button { width: 9%; background: rgb(130, 224, 255); border: none; padding: 10px; }
        #noteform { background: #000; padding: 3px; bottom: 0; width: 100%; }
        #noteform input { border: 0; padding: 10px; width: 90%; margin-right: .5%; }
        #noteform button { width: 9%; background: rgb(130, 224, 255); border: none; padding: 10px; }
        #mess_bar { list-style-type: none; margin: 0; padding: 0;    }
        #mess_bar li { padding: 5px 10px;text-align: left; }
        #mess_bar li:nth-child(odd) { background: #eee; }
        #note_bar { list-style-type: none; margin: 0; padding: 0;    }
        #note_bar li { padding: 5px 10px;text-align: left; }
        #note_bar li:nth-child(odd) { background: #eee; }
        #draggable { width: 50%; height: 500px; padding: 0.5em;background: #eee; }
        #errortxt{color:rgb(255,0,0)}
        form button { width: 9%; background: rgb(130, 224, 255); border: none; padding: 10px; }

    </style>
  </head>
<body class="index-page">

<!-- Navbar -->
    <nav class="navbar navbar-transparent navbar-fixed-top navbar-color-on-scroll">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navigation-index">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a href="./login">
                    <div class="logo-container">
                        <div class="logo">
                            <img src="assets/img/logo.png" alt="site Logo" rel="tooltip" title="logo" data-placement="bottom" data-html="true">
                        </div>
                        <div class="brand">
                            Argument Sys 
                        </div>


                    </div>
                </a>
            </div>

            <div class="collapse navbar-collapse" id="navigation-index">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="./signup">
                            <i class="material-icons">person_add</i> Sign up
                        </a><!--https://material.io/icons/-->
                    </li>
                    <li>
                        <a href="./login">
                            <i class="material-icons">chat</i> Enter activity
                        </a>
                    </li>
                    <li>
                        <a rel="tooltip" title="About ours" data-placement="bottom" href="http://ytwu.lst.ncu.edu.tw/wu/ch/" target="_blank" class="btn btn-white btn-simple btn-just-icon">
                            <i class="fa fa-info-circle"></i><!--http://fontawesome.io/icons/-->
                        </a>
                    </li>
                    <li>
                        <a rel="tooltip" title="Contact ours" data-placement="bottom" href="http://ytwu.lst.ncu.edu.tw/wu/ch/" target="_blank" class="btn btn-white btn-simple btn-just-icon">
                            <i class="fa fa-question-circle"></i>
                        </a>
                    </li>
                    <li>
                        <a rel="tooltip" title="Sitting" data-placement="bottom" href="./sitting_login" class="btn btn-white btn-simple btn-just-icon">
                            <i class="fa fa-cog"></i>
                        </a>
                    </li>

                </ul>
            </div>
        </div>
    </nav>
<!-- End Navbar -->




<div class="wrapper">
    <div class="header header-filter" style="background-image: url('assets/img/bg2.jpeg'); min-height:190px;height:0px;">
        <div class="container">


        </div>
    </div>
    <div class="main main-raised">
        <div class="section section-basic">
            
            <div class="container">
                <!-- Tabs with icons on Card -->
                        <div class="card card-nav-tabs">
                            <div class="header header-primary">
                                <!-- colors: "header-primary", "header-info", "header-success", "header-warning", "header-danger" -->
                                <div class="nav-tabs-navigation">
                                    <div class="nav-tabs-wrapper">
                                        <ul class="nav nav-tabs" data-tabs="tabs">
                                            <li class="active">
                                                <a href="#chatroom" data-toggle="tab">
                                                    <i class="material-icons">chat</i>
                                                    論證
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#note" data-toggle="tab">
                                                    <i class="material-icons">note_add</i>
                                                    筆記
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#search" data-toggle="tab">
                                                    <i class="material-icons">search</i>
                                                    搜尋資料
                                                </a>

                                            </li>
                                            
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="content">
                                <div class="tab-content text-center">
                                    <div class="tab-pane active" id="chatroom">
                                        <div class="title">  
                                            <h4 style="text-align: left;">
                                              <%=title%><%=room%>/使用者名稱：<%=UserName%><br> 題目：<br>
                                            </h4>
                                            <blockquote>
                                                <p class="text-left"><%=t_con%></p> 
                                            </blockquote> 
                                        </div>
                                        <div>
                                            
                                            <form action="">
                                              <input id="m" autocomplete="off" /><button>Send</button>
                                            </form>
                                            <ul id="mess_bar"></ul>

                                        </div>
                                    </div>
                                    <div class="tab-pane" id="note">
                                        <form action="" method="post" enctype="multipart/form-data">
                                            <textarea id="editor" class="ckeditor" name="editor"></textarea>
                                            <script>
                                            CKEDITOR.replace( 'editor', {
                                            
                                            });
                                            </script>
                                            <!--<input type="button" value="送出" onclick="processData()">-->
                                        </form>
                                    </div>
                                    <div class="tab-pane" id="search">
                                        <p>關鍵字搜尋</p>
                                        <div class="row" style="min-height:400px;">
                                        <div class="col-md-3">
                                            <input id="keywords_input" autocomplete="off" /><button onclick="searchkeword();">Send</button></input><br><br>
                                            <div id="search-result"></div>
                                        </div>
                                        <iframe id="insertweb" class="col-md-9" style="height:-webkit-fill-available" src=""></iframe>
                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                        </div>
<!-- End Tabs with icons on Card -->
                
            </div>
        </div>
    </div>
</div>
</body>
<script src="/socket.io/socket.io.js"></script>
<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script>

  var socket = io();
  var room_ID = '<%=room%>'
  var UserName = '<%=UserName%>'
  $('form').submit(function(){
    SendActionToSql($('#m').val(),'1');
    socket.emit('Push_message', UserName+': '+$('#m').val(),room_ID);
    $('#m').val('');
    return false;
  });

  socket.on(room_ID+'_upload_message', function(msg){
    $('#mess_bar').prepend($('<li>').text(msg));
  });

  
</script>

<script>
function SendActionToSql(Sentcontent,ad){
    $.post("http://140.115.126.216:3000/argument_post_action_list",
        {
            ad_id:ad,
            t_id:<%=t_id%>,
            content:Sentcontent
        },
        function(data,status){
            console.log(status);
        }
    );
    
}
 
</script>
<!--   Core JS Files   -->
<script src="assets/js/jquery.min.js" type="text/javascript"></script>
<script src="assets/js/bootstrap.min.js" type="text/javascript"></script>
<script src="assets/js/material.min.js"></script>

<!--  Plugin for the Sliders, full documentation here: http://refreshless.com/nouislider/ -->
<script src="assets/js/nouislider.min.js" type="text/javascript"></script>

<!--  Plugin for the Datepicker, full documentation here: http://www.eyecon.ro/bootstrap-datepicker/ -->
<script src="assets/js/bootstrap-datepicker.js" type="text/javascript"></script>

<!-- Control Center for Material Kit: activating the ripples, parallax effects, scripts from the example pages etc -->
<script src="assets/js/material-kit.js" type="text/javascript"></script>

<script type="text/javascript">

    $().ready(function(){
    // the body of this function is in assets/materiial-kit.js
    materialKit.initSliders();
    window_width = $(window).width();

    if (window_width >= 992){
        big_image = $('.wrapper > .header');

        $(window).on('scroll', materialKitDemo_mini.checkScrollForParallax);
    }

    });
</script>
<script>
    
    function GetReferences(keywords){
        $.get("./ReferencesShow?keywords="+keywords,
            function(data,status){                
                References_list = JSON.parse(data);
                console.log(References_list['text']);
                $('.links').remove();
                
                for (var i = 0; i < References_list["return"].length; i++){
                    //htmltext = '<option value="'+activity_list["return"][i]["topic_id"]+'">'+activity_list["return"][i]["content"]+'</option>'
                    htmltext ='<blockquote class="links"><button style="width: -webkit-fill-available;"onclick="rediract(\''+References_list["return"][i]["link"]+'\',\''+References_list["return"][i]["title"]+'\');" class="btn btn-info">'+References_list["return"][i]["title"]+'</button><small class = "text-right">'+References_list["return"][i]["memo"]+'</small></blockquote>'
                    $('#search-result').append(htmltext);                    
                }
                /*
                $('#TopicID').append('<optgroup id="HotTopic" label="Hot Topic">');
                htmltext = '<option value="10">厭世的人其實是先扭曲的自己的心靈，來防禦自己不受到傷害。</option>'
                $('#HotTopic').append(htmltext);
                htmltext = '<option value="20">實作學習</option>'
                $('#HotTopic').append(htmltext);  */
            }
        );
    
    }
    rediract('http://ytwu.lst.ncu.edu.tw/wu/ch/',"initial viewd");
    function rediract(link,title){
        $('#insertweb').attr("src",link);
        SendActionToSql(title,'4');
    }
     function searchkeword(){
        var keyval = $('#keywords_input').val();
        console.log(keyval);
        SendActionToSql(keyval,'3');
        $('.links').remove();
        GetReferences(keyval);
    } 
            

</script>
<script>
    function processData(){
       var data = CKEDITOR.instances["editor"].getData();
       SendActionToSql(data,'2');
    }
</script>
</html>
